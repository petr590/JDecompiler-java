Added `switch` support.
A little refactoring.
